package org.opentestsystem.rdw.admin.service;

import org.apache.commons.csv.CSVRecord;
import org.opentestsystem.rdw.admin.common.security.PermissionScope;
import org.opentestsystem.rdw.admin.model.CsvValidationFailure;

import java.util.Iterator;
import java.util.List;
import java.util.Set;

/**
 * Implementations of this interface are responsible for validating
 * a CSV representation of a Student Group submission.
 */
public interface CsvValidationService {

    /**
     * Validate the given CSV's headers and return the collection
     * of validation failures.
     *
     * @param csvHeaders CSV headers
     * @return The list of validation failures, empty if valid
     */
    List<CsvValidationFailure> validateHeaders(Set<String> csvHeaders);

    /**
     * Validate the given CSV records and return the collection
     * of validation failures.
     *
     * @param recordIterator    CSV records
     * @param permissionScope   The authenticated user's permissions
     * @return The list of validation failures, empty if valid
     */
    List<CsvValidationFailure> validateRecords(Iterator<CSVRecord> recordIterator, PermissionScope permissionScope);

    /**
     * Convert a collection of CSV validation failures into a single
     * truncated message string.
     *
     * @param failures A collection of CSV validation failures
     * @return A string representation of the failure messages
     */
    String toMessage(List<CsvValidationFailure> failures);
}
